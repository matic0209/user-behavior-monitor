# 📋 测试用例评审问题解答

## 概述
本文档详细回答测试用例评审中提出的问题，并提供具体的解决方案和实现细节。

## 🔍 问题1：深度学习分类准确率计算

### 问题描述
**基于深度学习的用户行为分类功能**
- 数据特征提取后自动运行分类评估
- 程序输出准确率/召回率/F1 等指标
- 指标达标性：准确率 ≥ 90%，F1-score ≥ 85%
- **问题**: 这个准确率是怎么计算的？

### 详细解答

#### 1.1 准确率计算方式
**准确率 (Accuracy)** = 正确预测的样本数 / 总样本数

```
Accuracy = (TP + TN) / (TP + TN + FP + FN)
```

其中：
- **TP (True Positive)**: 真阳性，正确预测为正类的样本数
- **TN (True Negative)**: 真阴性，正确预测为负类的样本数  
- **FP (False Positive)**: 假阳性，错误预测为正类的样本数
- **FN (False Negative)**: 假阴性，错误预测为负类的样本数

#### 1.2 其他指标计算方式

**精确率 (Precision)** = TP / (TP + FP)
- 预测为正类的样本中，真正为正类的比例

**召回率 (Recall)** = TP / (TP + FN)
- 实际正类样本中，被正确预测的比例

**F1-Score** = 2 × (Precision × Recall) / (Precision + Recall)
- 精确率和召回率的调和平均数

#### 1.3 阈值要求
- **准确率**: ≥ 90%
- **F1-Score**: ≥ 85%
- **召回率**: 建议 ≥ 80%
- **精确率**: 建议 ≥ 80%

#### 1.4 实现方式
在测试用例中，通过正则表达式从日志中提取这些指标：
```bash
# 准确率提取
ACCURACY=$(grep -o "accuracy[[:space:]]*=[[:space:]]*[0-9.]*" "$LOG_PATH" | grep -o "[0-9.]*")

# F1-score提取  
F1_SCORE=$(grep -o "f1[[:space:]]*=[[:space:]]*[0-9.]*" "$LOG_PATH" | grep -o "[0-9.]*")
```

---

## 🔍 问题2：异常行为告警阈值

### 问题描述
**用户异常行为告警功能**
- 启动客户端，程序进入监控状态，周期性输出预测日志
- 注入异常行为序列，计算得到异常分数 ≥ 阈值
- **问题**: 这个阈值是多少？

### 详细解答

#### 2.1 异常分数阈值设置
**默认阈值**: 0.8 (80%)

#### 2.2 阈值配置方式
```yaml
# 配置文件中的阈值设置
alert:
  anomaly_threshold: 0.8      # 异常检测阈值
  alert_threshold: 0.8        # 告警触发阈值
  lock_screen_threshold: 0.8  # 锁屏阈值
```

#### 2.3 阈值含义
- **0.0 - 0.6**: 正常行为，无需关注
- **0.6 - 0.8**: 可疑行为，记录日志
- **0.8 - 1.0**: 异常行为，触发告警

#### 2.4 阈值调整建议
- **开发测试**: 0.6 (降低阈值，提高敏感度)
- **生产环境**: 0.8 (平衡敏感度和准确性)
- **高安全要求**: 0.9 (提高阈值，减少误报)

#### 2.5 实现方式
在测试用例中，通过环境变量或配置文件设置：
```bash
export ANOMALY_THRESHOLD=0.8
export ALERT_THRESHOLD=0.8
```

---

## 🔍 问题3：异常行为拦截阈值

### 问题描述
**异常行为拦截功能**
- 注入高分异常序列（或使用专用脚本），输出异常分数 ≥ 锁屏阈值
- 观察系统行为，触发锁屏，或在无权限时记录明确降级处理
- **问题**: 这个阈值是多少？

### 详细解答

#### 3.1 锁屏阈值设置
**默认锁屏阈值**: 0.8 (80%)

#### 3.2 系统操作阈值配置
```yaml
system:
  lock_screen_threshold: 0.8      # 锁屏阈值
  force_logout_threshold: 0.85    # 强制登出阈值
  shutdown_threshold: 0.95        # 关机阈值
```

#### 3.3 阈值等级
- **0.8 - 0.85**: 触发锁屏
- **0.85 - 0.9**: 强制登出
- **0.9 - 0.95**: 系统警告
- **0.95 - 1.0**: 紧急关机

#### 3.4 权限检查和降级处理
当程序无足够权限执行系统操作时：

1. **记录权限不足日志**
2. **执行降级处理**:
   - 显示警告弹窗
   - 记录安全事件
   - 发送通知邮件
   - 记录到系统日志

#### 3.5 实现方式
```bash
# 检查系统操作权限
if [[ $(id -u) -eq 0 ]]; then
    # 有权限，执行锁屏
    xdg-screensaver lock
else
    # 无权限，记录降级处理
    log_warning "权限不足，无法执行锁屏操作"
    # 执行降级处理
    show_warning_dialog
fi
```

---

## 🔍 问题4：异常行为告警误报率

### 问题描述
**异常行为告警误报率**
- 启动离线评估或在线运行 ≥ N 小时，输出总窗口数、告警数、误报率
- 阈值校验：误报率 ≤ 1/1000
- 误报样本核查：误报集中在边界得分；可通过阈值或冷却优化降低
- **问题1**: 这个N小时具体是多少？
- **问题2**: 这个误报率是怎么计算的？

### 详细解答

#### 4.1 评估时间N小时设置

**具体时间配置**:
- **快速测试模式**: 1小时 (3600秒)
- **正常测试模式**: 4小时 (14400秒)  
- **生产测试模式**: 24小时 (86400秒)

**配置方式**:
```bash
export EVALUATION_TIME_HOURS=1    # 快速测试
export EVALUATION_TIME_HOURS=4    # 正常测试
export EVALUATION_TIME_HOURS=24   # 生产测试
```

#### 4.2 误报率计算方式详解

**方法1**: 误报率 = 误报次数 / 总检测次数
```
FPR = FP / (TP + TN + FP + FN)
```

**方法2**: 误报率 = 误报次数 / (误报次数 + 真阴性)
```
FPR = FP / (FP + TN)
```

**方法3**: 误报率 = 误报次数 / (误报次数 + 真阳性) **[推荐]**
```
FPR = FP / (FP + TP)
```

#### 4.3 阈值要求
**误报率要求**: ≤ 1/1000 = 0.1%

#### 4.4 误报样本分析

**边界得分误报**:
- 检查误报是否集中在阈值边界附近
- 分数在 0.75-0.85 范围内的误报

**优化策略**:
1. **阈值调整**: 提高异常检测阈值
2. **冷却时间**: 设置告警冷却期，避免频繁误报
3. **频率限制**: 限制单位时间内的告警次数
4. **上下文分析**: 结合时间、地点等上下文信息

#### 4.5 实现方式
```bash
# 评估时间设置
EVALUATION_TIME_HOURS=${EVALUATION_TIME_HOURS:-1}
EVALUATION_TIME_SECONDS=$((EVALUATION_TIME_HOURS * 3600))

# 误报率计算（推荐方法）
TOTAL_POSITIVES=$((FALSE_ALARMS + TRUE_POSITIVES))
if [[ $TOTAL_POSITIVES -gt 0 ]]; then
    FPR=$(echo "scale=4; $FALSE_ALARMS * 100 / $TOTAL_POSITIVES" | bc -l)
fi

# 阈值验证
THRESHOLD=0.1  # 0.1%
if [[ $(echo "$FPR <= $THRESHOLD" | bc -l) -eq 1 ]]; then
    echo "✓ 误报率满足要求"
else
    echo "✗ 误报率超过阈值"
fi
```

---

## 📊 总结

### 1. 准确率计算
- **计算方式**: (TP + TN) / (TP + TN + FP + FN)
- **阈值要求**: ≥ 90%
- **实现**: 从日志中提取指标并验证

### 2. 异常告警阈值
- **默认阈值**: 0.8 (80%)
- **可配置**: 通过配置文件或环境变量调整
- **建议**: 开发测试0.6，生产环境0.8

### 3. 锁屏阈值
- **默认阈值**: 0.8 (80%)
- **系统操作**: 锁屏、登出、关机等
- **降级处理**: 权限不足时执行替代方案

### 4. 误报率评估
- **评估时间**: 1-24小时（可配置）
- **计算方式**: FP / (FP + TP) [推荐]
- **阈值要求**: ≤ 0.1%
- **优化策略**: 阈值调整、冷却时间、频率限制

### 5. 测试用例修复
所有测试用例已修复，现在包含：
- 明确的指标计算方式
- 具体的阈值数值
- 详细的验证逻辑
- 完整的错误处理

通过这些修复，测试用例现在能够：
1. **准确验证性能指标**
2. **明确阈值要求**
3. **提供详细的分析结果**
4. **支持不同测试模式**
