# 发布版使用指南

## 问题解决

如果您在运行程序时遇到以下错误：

```
classification模块不可用，模型训练功能受限
predict模块不可用，预测功能受限
no such table: alerts
```

请按照以下步骤解决：

## 步骤1: 运行修复脚本

```cmd
python fix_release_issues.py
```

这个脚本会自动：
- 修复模块导入问题
- 初始化数据库表
- 创建模拟模块
- 修复导入语句
- 创建发布版构建脚本

## 步骤2: 使用发布版构建脚本

```cmd
python build_release.py
```

这个脚本会：
- 设置发布版环境
- 初始化数据库
- 构建可执行文件
- 包含所有必要的依赖和数据文件

## 发布版特性

### 1. 自动错误处理
- 模块缺失时自动使用模拟模块
- 数据库表不存在时自动创建
- 优雅的错误降级处理

### 2. 完整的依赖包含
- 包含整个src目录
- 包含data目录
- 包含所有必要的Python模块

### 3. 数据库自动初始化
- 自动创建alerts表
- 自动创建user_behavior表
- 自动创建model_info表

### 4. 模拟模块支持
- classification_mock.py：提供模拟的模型训练功能
- predict_mock.py：提供模拟的预测功能

## 构建脚本对比

| 脚本 | 用途 | 特点 |
|------|------|------|
| `build_release.py` | 发布版构建 | 生产级别，包含所有修复 |
| `build_windows_full.py` | Windows构建 | 完整功能，包含调试 |
| `build_safe.py` | 安全构建 | 基础功能，简单构建 |
| `build_cross_platform.py` | 跨平台构建 | 自动适配不同平台 |

## 发布版构建流程

### 1. 环境准备
```cmd
# 安装依赖
python install_dependencies_windows.py

# 修复问题
python fix_release_issues.py
```

### 2. 构建可执行文件
```cmd
# 发布版构建
python build_release.py
```

### 3. 验证构建结果
```cmd
# 检查文件
dir dist\UserBehaviorMonitor.exe

# 测试运行
dist\UserBehaviorMonitor.exe
```

## 发布版特性说明

### 错误处理机制
- **模块缺失**：自动使用模拟模块，不会崩溃
- **数据库问题**：自动创建必要的表
- **依赖缺失**：提供降级功能

### 功能降级
- **模型训练**：如果classification模块不可用，使用模拟训练
- **预测功能**：如果predict模块不可用，使用模拟预测
- **告警功能**：如果数据库不可用，使用内存存储

### 日志记录
- 所有错误都会记录到日志文件
- 提供详细的调试信息
- 支持不同级别的日志输出

## 故障排除

### 问题1: 模块导入错误
**解决**: 运行 `python fix_release_issues.py`

### 问题2: 数据库错误
**解决**: 脚本会自动创建数据库表

### 问题3: 构建失败
**解决**: 使用 `python build_release.py`

### 问题4: 运行时错误
**解决**: 检查日志文件，查看详细错误信息

## 成功标志

当看到以下输出时，表示发布版构建成功：

```
[SUCCESS] 发布版构建完成!
[INFO] 可执行文件已生成
```

## 验证发布版

1. **检查文件大小**：应该在50-200MB之间
2. **检查依赖**：确保所有必要的文件都包含
3. **测试运行**：确保程序能正常启动
4. **检查日志**：确保没有严重错误

---

**注意**: 发布版专门针对生产环境优化，包含了完整的错误处理和降级机制。
