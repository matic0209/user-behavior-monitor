# 用户行为异常检测系统 - 产品架构

## 🎯 产品定位

**用户行为异常检测系统** 是一个基于机器学习的智能安全监控产品，通过实时分析用户的鼠标行为模式，检测异常行为并自动采取安全措施。

### 核心价值
- **主动防护**: 在异常行为发生前进行预警
- **智能识别**: 基于机器学习自动识别异常模式
- **自动响应**: 检测到异常时自动锁屏保护
- **隐私保护**: 本地处理，数据不出本地

## 🏗️ 系统架构

### 整体架构图
```
┌─────────────────────────────────────────────────────────────┐
│                    用户行为异常检测系统                      │
├─────────────────────────────────────────────────────────────┤
│  用户界面层 (UI Layer)                                     │
│  ├── 快捷键控制界面                                        │
│  ├── 状态监控界面                                          │
│  └── 告警弹窗界面                                          │
├─────────────────────────────────────────────────────────────┤
│  业务逻辑层 (Business Logic Layer)                         │
│  ├── 用户管理模块                                          │
│  ├── 数据采集模块                                          │
│  ├── 特征工程模块                                          │
│  ├── 模型训练模块                                          │
│  ├── 预测推理模块                                          │
│  └── 告警响应模块                                          │
├─────────────────────────────────────────────────────────────┤
│  数据层 (Data Layer)                                       │
│  ├── SQLite数据库                                          │
│  ├── 模型存储                                              │
│  ├── 日志系统                                              │
│  └── 配置文件                                              │
├─────────────────────────────────────────────────────────────┤
│  系统接口层 (System Interface Layer)                       │
│  ├── Windows API (鼠标事件)                                │
│  ├── 系统锁屏接口                                          │
│  └── GUI接口 (tkinter)                                     │
└─────────────────────────────────────────────────────────────┘
```

## 🔄 核心业务流程

### 1. 系统初始化流程
```
启动系统 → 加载配置 → 初始化模块 → 启动用户管理 → 显示快捷键说明 → 启动自动工作流程
```

### 2. 自动工作流程
```
启动系统 → 自动数据采集 → 自动特征处理 → 自动模型训练 → 自动异常检测
```

### 3. 数据采集流程
```
自动开始采集 → 监听鼠标事件 → 存储到数据库 → 达到数据量或超时 → 停止采集
```

### 4. 特征处理流程
```
自动处理特征 → 提取行为特征 → 保存特征数据 → 准备模型训练
```

### 5. 模型训练流程
```
自动训练模型 → 使用XGBoost算法 → 保存模型文件 → 准备异常检测
```

### 6. 异常检测流程
```
自动开始预测 → 实时采集数据 → 特征提取 → 模型预测 → 异常判断 → 告警响应
```

### 7. 告警响应流程
```
检测到异常 → 显示警告弹窗 → 倒计时10秒 → 强制锁屏 → 记录告警日志
```

## 📊 功能模块详解

### 1. 用户管理模块 (UserManager)
**职责**: 用户身份管理、会话管理、快捷键监听
**核心功能**:
- 自动生成用户ID (Windows用户名_时间戳)
- 管理用户会话和配置
- 监听键盘快捷键
- 提供回调函数机制

**关键特性**:
- 支持连续按键检测 (4次相同按键)
- 自动保存用户配置
- 支持重新训练模式
- 简化的快捷键系统 (rrrr、aaaa、qqqq)

### 2. 数据采集模块 (DataCollector)
**职责**: 实时采集用户行为数据
**核心功能**:
- 监听鼠标移动、点击、滚动事件
- 记录事件时间戳、坐标、按钮信息
- 数据缓冲和批量存储
- 会话管理和数据组织

**关键特性**:
- 高精度时间戳记录
- 内存缓冲区优化
- 自动会话管理
- 数据完整性验证
- 自动采集控制

### 3. 特征工程模块 (FeatureProcessor)
**职责**: 从原始数据中提取行为特征
**核心功能**:
- 速度特征 (移动速度、加速度)
- 轨迹特征 (路径复杂度、方向变化)
- 时间特征 (点击间隔、持续时间)
- 统计特征 (均值、方差、分布)
- 几何特征 (坐标分布、点击模式)

**关键特性**:
- 滑动窗口处理
- 多维度特征提取
- 特征标准化
- 数据清洗和验证
- 自动特征处理

### 4. 模型训练模块 (ModelTrainer)
**职责**: 训练异常检测模型
**核心功能**:
- 数据预处理和清洗
- 特征选择和工程
- 模型训练和验证
- 模型性能评估
- 模型文件管理

**关键特性**:
- 支持XGBoost算法
- 自动超参数调优
- 交叉验证
- 模型版本管理
- 自动模型训练

### 5. 预测推理模块 (Predictor)
**职责**: 实时异常检测
**核心功能**:
- 实时数据采集
- 特征提取和预处理
- 模型推理
- 异常分数计算
- 结果缓存和优化

**关键特性**:
- 低延迟推理
- 批量处理优化
- 异常分数阈值管理
- 预测结果缓存
- 自动异常检测

### 6. 告警响应模块 (AlertService)
**职责**: 异常告警和响应
**核心功能**:
- 异常检测触发
- 告警消息生成
- 系统操作执行
- 告警日志记录
- 告警统计管理

**关键特性**:
- 多级别告警
- 自动锁屏保护
- 告警冷却机制
- 告警历史记录
- 自定义告警响应

## 🔧 技术实现细节

### 数据采集技术
- **Windows API**: 使用win32api监听鼠标事件
- **事件缓冲**: 内存缓冲区优化性能
- **数据持久化**: SQLite数据库存储
- **会话管理**: 自动会话创建和管理

### 特征工程技术
- **滑动窗口**: 动态窗口特征提取
- **多维度特征**: 速度、轨迹、时间、统计特征
- **特征标准化**: 数据预处理和归一化
- **特征选择**: 自动特征重要性评估

### 机器学习技术
- **XGBoost算法**: 高效的梯度提升算法
- **异常检测**: 基于监督学习的异常检测
- **模型评估**: 交叉验证和性能指标
- **模型持久化**: 模型文件保存和加载

### 实时预测技术
- **流式处理**: 实时数据流处理
- **批量推理**: 批量预测优化性能
- **阈值管理**: 动态异常检测阈值
- **结果缓存**: 预测结果缓存机制

### 告警响应技术
- **GUI告警**: tkinter弹窗告警
- **系统操作**: Windows API锁屏
- **告警冷却**: 防止告警频繁触发
- **日志记录**: 完整的告警日志

## 📈 性能优化

### 内存优化
- **数据分块**: 大文件分块处理
- **及时清理**: 及时清理临时数据
- **内存监控**: 监控内存使用情况
- **缓冲区管理**: 优化缓冲区大小

### 速度优化
- **并行处理**: 使用多线程处理
- **缓存机制**: 缓存常用数据
- **算法优化**: 选择高效的算法
- **批量操作**: 批量数据库操作

### 存储优化
- **数据压缩**: 压缩历史数据
- **定期清理**: 清理过期数据
- **索引优化**: 优化数据库索引
- **文件轮转**: 日志文件轮转

## 🔒 安全考虑

### 数据安全
- **本地处理**: 所有数据本地处理
- **数据加密**: 敏感数据加密存储
- **访问控制**: 严格的访问权限控制
- **数据备份**: 定期数据备份

### 系统安全
- **权限管理**: 最小权限原则
- **进程隔离**: 进程间隔离
- **异常处理**: 完善的异常处理机制
- **日志审计**: 完整的操作日志

### 网络安全
- **本地部署**: 本地部署避免网络风险
- **防火墙配置**: 适当的防火墙配置
- **端口管理**: 严格控制端口使用
- **协议安全**: 使用安全的通信协议

## 🚀 部署方案

### 单机部署
- **环境要求**: Windows 10/11, Python 3.7+
- **安装方式**: pip安装依赖包
- **启动方式**: 命令行启动
- **监控方式**: 日志文件监控

### 企业部署
- **服务器部署**: 部署到企业服务器
- **客户端安装**: 批量安装客户端
- **集中管理**: 统一的配置管理
- **监控告警**: 企业级监控告警

### 云部署
- **容器化**: Docker容器部署
- **微服务**: 微服务架构
- **负载均衡**: 负载均衡配置
- **自动扩缩**: 自动扩缩容

## 📊 监控指标

### 系统性能指标
- **CPU使用率**: 系统CPU使用情况
- **内存使用率**: 系统内存使用情况
- **磁盘使用率**: 磁盘空间使用情况
- **网络使用率**: 网络带宽使用情况

### 业务指标
- **数据采集量**: 每日数据采集量
- **异常检测率**: 异常检测准确率
- **告警响应时间**: 告警响应时间
- **系统可用性**: 系统运行时间

### 安全指标
- **异常事件数**: 检测到的异常事件数
- **告警频率**: 告警触发频率
- **误报率**: 误报事件比例
- **漏报率**: 漏报事件比例

## 🔮 未来规划

### 功能扩展
- **多模态数据**: 支持键盘、触摸等数据
- **深度学习**: 集成深度学习算法
- **云端同步**: 支持云端数据同步
- **移动端支持**: 支持移动设备

### 性能优化
- **GPU加速**: 支持GPU加速计算
- **分布式处理**: 支持分布式处理
- **实时流处理**: 支持实时流处理
- **边缘计算**: 支持边缘计算

### 安全增强
- **生物识别**: 集成生物识别技术
- **行为分析**: 更深入的行为分析
- **威胁情报**: 集成威胁情报
- **合规支持**: 支持各种合规要求

## 📝 开发指南

### 代码规范
- **PEP 8**: 遵循Python代码规范
- **类型注解**: 使用类型注解
- **文档字符串**: 完整的文档字符串
- **单元测试**: 完整的单元测试

### 版本控制
- **Git管理**: 使用Git版本控制
- **分支策略**: 合理的分支策略
- **代码审查**: 严格的代码审查
- **自动化测试**: 自动化测试流程

### 持续集成
- **CI/CD**: 持续集成和部署
- **自动化测试**: 自动化测试流程
- **代码质量**: 代码质量检查
- **安全扫描**: 安全漏洞扫描

## 📞 技术支持

### 文档支持
- **用户手册**: 详细的使用说明
- **开发文档**: 完整的开发文档
- **API文档**: 详细的API文档
- **故障排除**: 常见问题解决方案

### 社区支持
- **GitHub**: GitHub项目页面
- **Issue跟踪**: 问题跟踪和反馈
- **讨论区**: 用户讨论区
- **贡献指南**: 贡献代码指南

### 商业支持
- **技术支持**: 专业技术支持
- **定制开发**: 定制化开发服务
- **培训服务**: 用户培训服务
- **咨询服务**: 技术咨询服务 