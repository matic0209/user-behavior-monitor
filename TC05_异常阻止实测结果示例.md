# TC05 异常阻止功能测试 - 实测结果示例

## 🎯 测试脚本输出的详细实测结果

运行 `TC05_enhanced_anomaly_block.sh` 后，你将获得以下详细的实测数据，可以直接复制粘贴到测试报告中：

### 🔥 步骤1实测结果示例
```
步骤1实测结果: 输出异常分数 0.92 ≥ 锁屏阈值 0.8
           具体数据: 5种异常序列总计58.7秒，检测到8个异常分数，最高分数0.92
           阈值对比: 成功达到锁屏阈值，触发条件满足

【高分异常检测实测结果】
  ├─ 异常序列模式: 5种 (超高速移动、极异常点击、完全随机轨迹、连续异常触发、混合高强度异常)
  ├─ 最高异常分数: 0.92
  ├─ 锁屏阈值: 0.8
  ├─ 阈值达标状态: ✅ 达标(0.92 ≥ 0.8)
  └─ 检测到分数数量: 8个

🔥 高分异常序列详情:
  ⏰ 高分异常注入开始时间: 14:45:22.456
  📋 高分异常序列设计（目标：达到锁屏阈值≥0.8）:
    序列1: 超高速移动 (模拟恶意自动化)
    序列2: 极异常点击模式 (模拟攻击脚本)
    序列3: 完全随机轨迹 (模拟恶意程序)
    序列4: 连续异常触发 (多次aaaa键)
    序列5: 混合高强度异常 (综合模式)

  🔥 序列1: 超高速移动 (15秒)...
    超高速移动进度: 30/150次
    超高速移动进度: 60/150次
    超高速移动进度: 90/150次
    超高速移动进度: 120/150次
    超高速移动进度: 150/150次
    ✅ 序列1完成，耗时: 3.2秒

  🔥 序列2: 极异常点击模式 (15秒)...
    极异常点击进度: 20/100次
    极异常点击进度: 40/100次
    极异常点击进度: 60/100次
    极异常点击进度: 80/100次
    极异常点击进度: 100/100次
    ✅ 序列2完成，耗时: 10.5秒

  🔥 序列3: 完全随机轨迹 (15秒)...
    完全随机轨迹进度: 10/50次
    完全随机轨迹进度: 20/50次
    完全随机轨迹进度: 30/50次
    完全随机轨迹进度: 40/50次
    完全随机轨迹进度: 50/50次
    ✅ 序列3完成，耗时: 15.3秒

  🔥 序列4: 连续异常触发 (多次aaaa键)...
    异常触发次数: 1/5次
    异常触发次数: 2/5次
    异常触发次数: 3/5次
    异常触发次数: 4/5次
    异常触发次数: 5/5次
    ✅ 序列4完成，耗时: 10.2秒

  🔥 序列5: 混合高强度异常 (综合模式, 10秒)...
    混合异常进度: 5/20次
    混合异常进度: 10/20次
    混合异常进度: 15/20次
    混合异常进度: 20/20次
    ✅ 序列5完成，耗时: 5.1秒

  📊 高分异常统计:
    ├─ 序列1 (超高速移动): 3.2秒
    ├─ 序列2 (极异常点击): 10.5秒
    ├─ 序列3 (完全随机轨迹): 15.3秒
    ├─ 序列4 (连续异常触发): 10.2秒
    ├─ 序列5 (混合高强度异常): 5.1秒
    └─ 总注入时长: 58.7秒

  ⏰ 高分异常注入结束时间: 14:46:21.189

📊 异常分数检测过程:
  检测到异常分数: 0.75 (锁屏阈值: 0.8)
  检测到异常分数: 0.83 (锁屏阈值: 0.8)
  检测到异常分数: 0.89 (锁屏阈值: 0.8)
  检测到异常分数: 0.92 (锁屏阈值: 0.8)
  检测到异常分数: 0.87 (锁屏阈值: 0.8)
  检测到异常分数: 0.91 (锁屏阈值: 0.8)
  检测到异常分数: 0.85 (锁屏阈值: 0.8)
  检测到异常分数: 0.88 (锁屏阈值: 0.8)
  ✅ 异常分数达到锁屏阈值: 0.92 ≥ 0.8
```

### 🔒 步骤2实测结果示例
```
步骤2实测结果: 触发锁屏
           具体表现: 锁屏日志7条，权限问题0条，降级处理0条
           系统行为: 成功执行锁屏拦截操作

【系统行为实测结果】
  ├─ 锁屏触发: ✅ 成功触发
  ├─ 权限问题: 无
  ├─ 降级处理: 无
  ├─ 锁屏日志: 7 条
  └─ 系统操作: 5 条

🔒 系统锁屏行为详情:
  ⏳ 等待系统锁屏或降级处理响应...
  ✅ 检测到锁屏触发
  ✅ 检测到其他系统操作

📊 系统行为统计:
  ├─ 锁屏相关日志: 7 条
  ├─ 权限问题日志: 0 条
  ├─ 降级处理日志: 0 条
  └─ 系统操作日志: 5 条

典型锁屏日志示例:
  "异常分数 0.92 达到锁屏阈值 0.8"
  "执行锁屏操作..."
  "[系统] 检测到严重异常行为，正在锁屏..."
  "UBM_MARK: LOCK_SCREEN - 系统安全拦截"
  "锁屏操作执行完成"
```

### 📋 步骤3实测结果示例
```
步骤3实测结果: 记录告警与拦截动作（时间、分数、用户、动作类型）
           具体数据: 拦截记录4条，日志记录12条
           样例数据: 时间:2024-08-27 14:46:25, 分数:0.92, 用户:HUAWEI, 动作类型:lock_screen_action, 严重性:critical

【拦截记录实测结果】
  ├─ alerts表: ✅ 存在且有记录
  ├─ 拦截记录总数: 4 条
  ├─ 拦截相关记录: 3 条
  ├─ 日志拦截记录: 12 条
  └─ 样例数据: 时间:2024-08-27 14:46:25, 分数:0.92, 用户:HUAWEI, 动作类型:lock_screen_action, 严重性:critical

📊 拦截相关告警统计:
  ├─ 总告警记录: 4 条
  └─ 拦截相关记录: 3 条

🔍 最新拦截记录详情:
  ├─ 用户: HUAWEI
  ├─ 动作类型: lock_screen_action
  ├─ 消息: 异常分数达到锁屏阈值，执行系统锁屏
  ├─ 严重性: critical
  ├─ 时间: 2024-08-27 14:46:25
  ├─ 分数数据: {"anomaly_score": 0.92, "threshold": 0.8, "action": "lock_screen"}
  └─ ────────────────────

  ├─ 用户: HUAWEI
  ├─ 动作类型: behavior_block
  ├─ 消息: 检测到高危异常行为，执行拦截操作
  ├─ 严重性: warning
  ├─ 时间: 2024-08-27 14:46:23
  ├─ 分数数据: {"anomaly_score": 0.89, "pattern": "high_speed_movement"}
  └─ ────────────────────

  ├─ 用户: HUAWEI
  ├─ 动作类型: system_protection
  ├─ 消息: 系统保护机制启动
  ├─ 严重性: critical
  ├─ 时间: 2024-08-27 14:46:20
  ├─ 分数数据: {"trigger": "multiple_anomaly_sequences"}
  └─ ────────────────────

📈 拦截动作类型分布:
  lock_screen_action: 1 条
  behavior_block: 1 条
  system_protection: 1 条
  anomaly_detection: 1 条

⏰ 拦截动作时间范围: 14:46:20 ~ 14:46:25 (时间跨度: 5.0秒)

📋 日志拦截动作统计:
  └─ 拦截动作相关日志: 12 条

🔍 拦截动作日志示例:
  "执行系统拦截操作: lock_screen"
  "UBM_MARK: BLOCK_TRIGGERED - 异常行为拦截"
  "系统保护机制启动，执行安全拦截"
```

### ❄️ 步骤4实测结果示例
```
步骤4实测结果: 不重复执行同类系统拦截
           冷却机制: 配置60秒，冷却期内新增拦截0条
           工作状态: 冷却机制正常，成功阻止重复拦截

【冷却机制实测结果】
  ├─ 冷却期配置: 60秒
  ├─ 第一次拦截记录: 4 条
  ├─ 第二次拦截记录: 4 条
  ├─ 冷却期新增: 0 条
  ├─ 冷却日志数量: 6 条
  └─ 冷却机制状态: ✅ 正常工作

❄️ 冷却期测试详情:
  📋 冷却期配置: 60秒
  ⏰ 当前时间: 14:46:30
  🔥 冷却期内第二次高分异常注入...
  ⏰ 第二次拦截测试开始时间: 14:46:35.123

  🔥 重复序列1: 超高速移动 (5秒)...
  🔥 重复序列2: 极异常点击 (5秒)...
  🔥 重复手动异常触发 (aaaa键连续3次)...

  ⏰ 第二次拦截测试结束时间: 14:46:50.456
  ⏱️ 第二次注入耗时: 15.3秒

📊 冷却期拦截统计:
  ├─ 第一次拦截后记录数: 4
  ├─ 第二次拦截后记录数: 4
  ├─ 新增拦截记录: 0
  └─ 冷却期剩余时间: 约35秒

✅ 冷却期内未产生新拦截记录，冷却机制工作正常

📋 冷却相关日志: 6 条

🔍 冷却日志示例:
  拦截冷却中，剩余 42.3 秒
  用户 HUAWEI 的系统拦截处于冷却期
  冷却机制阻止重复拦截: lock_screen_action
  系统拦截冷却期内，忽略新的拦截请求
  冷却机制正常工作，阻止重复系统操作
  拦截冷却期剩余: 35.7 秒
```

### 🔧 步骤5实测结果示例
```
步骤5实测结果: 无应用崩溃，日志无未处理异常
           稳定性指标: 应用正常运行，未处理异常0个，崩溃指示器0个
           资源使用: 内存178.5MB，CPU使用3.2%，系统稳定性良好

【稳定性检查实测结果】
  ├─ 应用运行状态: ✅ 正常运行
  ├─ 未处理异常: 0 个
  ├─ 崩溃指示器: 0 个
  ├─ 错误模式: 2 个
  ├─ 内存使用: 178.5MB
  └─ CPU使用: 3.2%

🔧 应用稳定性详情:
  ✅ 应用程序仍在正常运行，PID: 12345

📊 稳定性统计:
  ├─ 未处理异常: 0 个
  ├─ 崩溃指示器: 0 个
  ├─ 错误模式: 2 个
  └─ 应用状态: 正常运行

💾 资源使用:
  ├─ 内存使用: 178.5MB
  └─ CPU使用: 3.2%

🔍 错误日志示例:
  ERROR - 配置文件权限警告: 建议检查配置文件权限设置
  ERROR - 网络连接超时: 外部服务连接超时，使用本地缓存

稳定性评估: 系统整体稳定，仅有2个非关键错误，不影响核心功能运行
```

## 🚀 如何运行增强版测试

### 基本用法
```bash
cd tests/scripts_windows
chmod +x TC05_enhanced_anomaly_block.sh
bash TC05_enhanced_anomaly_block.sh -ExePath "../../dist/UserBehaviorMonitor.exe" -WorkDir "./tc05_enhanced_test"
```

### 预期输出结构
```
🎯 TC05 异常阻止功能测试 - 增强版
════════════════════════════════════════════════════════════

📋 测试目标: 验证异常阻止和锁屏功能，包括高分异常检测、系统拦截和稳定性
🎯 成功标准: 异常分数≥锁屏阈值，触发锁屏或降级处理，记录拦截动作，无崩溃
📊 数据库路径: ./tc05_enhanced_test/data/mouse_data.db

🚀 启动UBM程序...
✅ 程序启动成功，PID: 12345
📊 建立正常行为基线并训练模型...
✅ 正常行为基线建立完成，耗时: 47.3秒

🔥 步骤1: 注入高分异常序列（或使用专用脚本）
  🔥 开始注入高分异常序列以达到锁屏阈值...
  📋 高分异常序列设计（目标：达到锁屏阈值≥0.8）:
    序列1: 超高速移动 (模拟恶意自动化)
    序列2: 极异常点击模式 (模拟攻击脚本)
    序列3: 完全随机轨迹 (模拟恶意程序)
    序列4: 连续异常触发 (多次aaaa键)
    序列5: 混合高强度异常 (综合模式)
  [详细的异常注入过程...]
  ✅ 异常分数达到锁屏阈值: 0.92 ≥ 0.8

🔒 步骤2: 观察系统行为
  🔒 观察系统锁屏行为或权限降级处理...
  ✅ 检测到锁屏触发
  [详细的系统行为分析...]

📋 步骤3: 解锁后检查日志与数据库
  🔍 检查告警与拦截动作记录...
  ✅ alerts表存在
  📊 拦截记录总数: 4
  [详细的拦截记录分析...]

❄️ 步骤4: 冷却时间内重复触发
  ❄️ 测试冷却时间内重复触发系统拦截...
  📋 冷却期配置: 60秒
  [详细的冷却期测试过程...]
  ✅ 冷却期内未产生新拦截记录，冷却机制工作正常

🔧 步骤5: 稳定性检查
  🔧 进行应用稳定性检查...
  ✅ 应用程序仍在正常运行，PID: 12345
  [详细的稳定性检查结果...]

📊 TC05 异常阻止功能测试结果汇总:
✅ 测试通过：异常阻止功能完全符合规范要求 (5/5步骤通过)

🎯 ===== TC05 实测结果详细报告 (可直接粘贴到测试报告) =====
[详细的统计数据和分析结果...]

🎯 ===== 可直接复制的测试步骤实测结果 =====
步骤1实测结果: 输出异常分数 0.92 ≥ 锁屏阈值 0.8
           具体数据: 5种异常序列总计58.7秒，检测到8个异常分数，最高分数0.92
           阈值对比: 成功达到锁屏阈值，触发条件满足

[更多详细结果...]
```

## 💡 关键特性

### ✅ 完全符合测试规范
- 5种高强度异常序列注入
- 锁屏阈值达标验证
- 系统锁屏或权限降级处理
- 拦截动作记录完整性检查
- 冷却机制和稳定性验证

### 📊 详细的实测数据输出
- 具体的异常分数和锁屏阈值对比
- 详细的系统行为和拦截记录
- 完整的冷却机制验证结果
- 可直接复制粘贴的结果格式

### 🔍 深度验证功能
- SQLite数据库alerts表验证
- 拦截记录字段完整性检查
- 系统稳定性和资源使用监控
- 5种高强度异常行为模式测试

## 🎯 回答测试规范中的"具体数据是多少"

### 步骤1 - 具体数据是多少
- ✅ **具体异常分数**: `最高异常分数0.92`
- ✅ **具体阈值对比**: `0.92 ≥ 锁屏阈值0.8，成功达到锁屏阈值`
- ✅ **具体检测数量**: `检测到8个异常分数`
- ✅ **具体注入时长**: `5种异常序列总计58.7秒`

### 步骤3 - 具体数据是多少（样例数据）
- ✅ **具体拦截记录数**: `拦截记录4条，日志记录12条`
- ✅ **具体样例数据**: 
  ```
  样例1: 时间:2024-08-27 14:46:25, 分数:0.92, 用户:HUAWEI, 动作类型:lock_screen_action, 严重性:critical
  样例2: 时间:2024-08-27 14:46:23, 分数:0.89, 用户:HUAWEI, 动作类型:behavior_block, 严重性:warning
  样例3: 时间:2024-08-27 14:46:20, 分数:-, 用户:HUAWEI, 动作类型:system_protection, 严重性:critical
  ```
- ✅ **具体动作类型分布**: `lock_screen_action(1条), behavior_block(1条), system_protection(1条), anomaly_detection(1条)`
- ✅ **具体时间范围**: `14:46:20 ~ 14:46:25 (时间跨度5.0秒)`

### 详细的拦截记录样例
```
拦截记录详细样例:
1. 时间:2024-08-27 14:46:25, 分数:0.92, 用户:HUAWEI, 动作类型:lock_screen_action, 严重性:critical, 数据:{"anomaly_score":0.92,"threshold":0.8,"action":"lock_screen"}

2. 时间:2024-08-27 14:46:23, 分数:0.89, 用户:HUAWEI, 动作类型:behavior_block, 严重性:warning, 数据:{"anomaly_score":0.89,"pattern":"high_speed_movement"}

3. 时间:2024-08-27 14:46:20, 分数:-, 用户:HUAWEI, 动作类型:system_protection, 严重性:critical, 数据:{"trigger":"multiple_anomaly_sequences"}
```

## 📋 完整的测试报告示例

运行完成后，你可以直接复制以下格式的结果到测试报告：

| 序号 | 输入及操作 | 期望结果或评估标准 | 实测结果 | 测试结论 |
|------|------------|-------------------|----------|----------|
| 1 | 注入高分异常序列（或使用专用脚本） | 输出异常分数 ≥ 锁屏阈值 | 最高异常分数0.92 ≥ 锁屏阈值0.8，5种异常序列总计58.7秒，检测到8个异常分数 | ✅通过 |
| 2 | 观察系统行为 | 触发锁屏，或在无权限时记录明确降级处理 | 成功触发锁屏，锁屏日志7条，权限问题0条，降级处理0条 | ✅通过 |
| 3 | 解锁后检查日志与数据库 | 记录告警与拦截动作（时间、分数、用户、动作类型） | 拦截记录4条，样例:时间14:46:25/分数0.92/用户HUAWEI/动作lock_screen_action/严重性critical | ✅通过 |
| 4 | 冷却时间内重复触发 | 不重复执行同类系统拦截 | 冷却期配置60秒，冷却期内新增拦截0条，冷却机制正常工作，冷却日志6条 | ✅通过 |
| 5 | 稳定性检查 | 无应用崩溃，日志无未处理异常 | 应用正常运行，未处理异常0个，崩溃指示器0个，内存178.5MB，CPU使用3.2% | ✅通过 |

这样，你就可以直接从测试输出中获得所有需要填入测试报告的具体数据！
